/* Schwarze Linie */ // Alle 18.04.2013

#include "linefunctions.h"

task main()
{
     InitSensors();
     StartTiming();
     GreenAttempts = 0;
     DownFloor = true;
     while(DownFloor)
     {
                     HandleCounting();
                     CheckForLongSync();
                     SpeedLeft = Speednorm;
                     SpeedRight = Speednorm;
                     time = ReturnTime();
                     if(SENSOR_2 < Schwarzwert)
                     {
                              TurnRight();
                     }
                     if((SENSOR_3 < Schwarzwert) && (ReturnSensorTime() > stime))
                     {
                              TurnLeft();
                     }
                     if((time > 1500) && (ReturnSensorTime() > stime))
                     {
                              if(DirectionRight == true)
                              {
                                  SpeedLeft = 50;
                                  SpeedRight = 30;
                              }
                              else
                              {
                                  SpeedLeft = 30;
                                  SpeedRight = 50;
                              }
                     }
                     if(DownFloor == false)
                     {
                              Align();
                     }
                     OnRev(OUT_A, 70);
                     OnFwd(OUT_B, SpeedLeft);
                     OnFwd(OUT_C, SpeedRight);
                     Wait(20);
                     Off(OUT_BC);
     }
     while(true)
     {
     OnRev(OUT_A, 70);
     MicroLine();
     DoRotations(360,-100,1,-100);
     OnFwd(OUT_A,70);
     Wait(500);
     Off(OUT_A);                       // bis hier überprüfen
     LongLine1();
     Dose = CheckForDose();
     TurnRight45();
     if(MiniLine() <= AveragePodVal)
     {
         PutDownCan();
         break;
     }
                     //position = 1;
     NumOut(0,LCD_LINE1,position);
     Dose = CheckForDose();
     TurnRight45();
     MicroLine();
     Dose = CheckForDose();
     TurnRight45();
     if(MiniLine() <= AveragePodVal)
     {
          PutDownCan();
          break;
     }
     NumOut(0,LCD_LINE1,position);
     Dose = CheckForDose();
     TurnRight45();
     LongLine2();
     Dose = CheckForDose();
     TurnRight45();
     if(MiniLine() <= AveragePodVal)
     {
         PutDownCan();
         break;
     }
     NumOut(0,LCD_LINE1,position);
     Dose = CheckForDose();
     TurnRight45();
     MicroLine();
     Wait(5000000000); //nicht fertig
     }
}
